import{_ as c,a as o}from"./table.a22df2d5.js";import{_ as l,a}from"./form.074c66d7.js";import{_ as u}from"./dialog.95f029d0.js";import{_ as d}from"./pagination.9aad1d0d.js";import{_ as p,a as m}from"./select.b4520541.js";import{V as y,j as h}from"./codeMirror.02d3b085.js";import{g,n as f}from"./vueConfig.8449a054.js";import{s as k,e as _,n as v}from"./notify.6ccdfc15.js";import"./checkbox.9916a5da.js";import"./scrollbar.17ff5e4e.js";import"./index.c53e94d1.js";import"./checkbox-group.533d9657.js";import"./index.0138aacd.js";import"./focus.d0673314.js";let s;const b={components:{codemirror:y.codemirror},destroyed(){s.destroy()},data(){return{cmOptions:{tabSize:4,mode:"text/plain",theme:"base16-dark",lineNumbers:!1,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-foldgutter"],foldOptions:void 0},cmContent:"",language:{current:"Text",supports:["Text","JSON","Yaml"],map:{Text:"text/plain",JSON:"application/json",Yaml:"text/yaml"}},itemModel:{old:null,key:null,score:null,value:null},searchInput:"",pageIndex:1,pageSize:100,dataCount:0,remainHeight:0,keyLoading:!0,key:{name:"",ttl:-1,content:null,count:null,type:null},edit:{name:"",ttl:-1,content:null},itemDialogVisiable:!1,selectStyle:{float:this.float},textrows:6}},mounted(){const n=()=>{var i;const e=(i=this.$refs.infoForm)==null?void 0:i.$el,t=e?e.clientHeight:46;this.remainHeight=window.innerHeight-40-t};n(),new ResizeObserver(n).observe(document.body),window.addEventListener("resize",n),s=g(),s.on("detail",e=>{this.keyLoading=!1,this.language.current="Text",this.pageIndex=e.page.pageNum,this.pageSize=e.page.pageSize,this.itemDialogVisiable=!1,this.key=e.res,this.edit=this.deepClone(e.res),["string","ReJSON-RL"].includes(this.key.type)&&(this.cmContent=this.edit.content),this.autoDetect()}).on("pagination",e=>{this.key.content=e}).on("msg",e=>{k(e)}).on("error",e=>{_(e)}).on("refresh",e=>{v({showClose:!0,duration:1500,message:e,type:"success"}),this.refresh()}),s.emit("routed")},computed:{codemirror(){var n;return(n=this.$refs.cmEditor)==null?void 0:n.codemirror},isJSON(){var n;return["string","ReJSON-RL"].includes(this.key.type)&&((n=this.edit.content)==null?void 0:n.match(/^\s*[{[]/))!=null},filterData(){var t;const n=this.searchInput,e=this.key.content.filter(i=>!n||(i.value?i.value.includes(n):i.includes(n)));return this.dataCount=(t=this.key.count)!=null?t:e.length,e},dialogTitle(){const n=this.itemModel.old;switch(this.key.type){case"hash":return n?"Edit Hash":"Add to hash";case"set":return n?"Edit Set":"Add to set";case"zset":return n?"Edit ZSet":"Add to zset";case"list":return n?"Edit List":"Add to list"}return""},dynamicHeight(){return window.innerHeight-100+"px"}},methods:{changePage(n,e){s.emit("changePage",e?n:this.pageIndex+n)},autoDetect(){!this.key||!["string","ReJSON-RL"].includes(this.key.type)||this.$nextTick(()=>{this.isJSON?(this.language.current="JSON",this.format("JSON"),this.changeLanguage("JSON")):(this.language.current="Text",this.changeLanguage("Text"))})},format(n){var e;if(n=="JSON")try{const t=this.cmContent;this.cmContent=JSON.stringify(JSON.parse((e=t==null?void 0:t.replace)==null?void 0:e.call(t,/Â /g," ")),null,4)}catch(t){console.log(t)}},changeLanguage(n){if(!this.codemirror)return;const e=this.language.map[n];this.codemirror.setOption("mode",e),this.codemirror.setOption("foldOptions",n=="JSON"?h(this.codemirror):void 0)},refresh(){this.itemDialogVisiable=!1,s.emit("refresh",{key:this.key})},saveItem(){s.emit("saveItem",this.itemModel)},showOpenDialog(){this.itemModel={},this.itemDialogVisiable=!0},showEditDialog(n){this.itemModel={...n,old:{...n}},this.itemDialogVisiable=!0},deleteLine(n){this.$confirm("Are you sure you want to delete this key?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{s.emit("deleteLine",n)})},deleteKey(){this.$confirm("Are you sure you want to delete this key?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{s.emit("del",{key:{name:this.key.name}}),this.key={},this.edit={}})},rename(){console.log(this.key.name),s.emit("rename",{key:{name:this.key.name,newName:this.edit.name}})},ttlKey(){s.emit("ttl",{key:{name:this.key.name,ttl:this.edit.ttl}})},update(){s.emit("update",{key:{name:this.key.name,newName:this.edit.name,type:this.key.type,content:this.cmContent}})},deepClone(n){let e=Array.isArray(n)?[]:{};if(n&&typeof n=="object")for(let t in n)n.hasOwnProperty(t)&&(n[t]&&typeof n[t]=="object"?e[t]=this.deepClone(n[t]):e[t]=n[t]);return e}}};var x=function(){var e=this,t=e._self._c;return t("div",{staticClass:"redis-view-container",attrs:{id:"app"}},[e.keyLoading?[t("div",{staticStyle:{"text-align":"center"}},[e._v(" loading ")])]:t("div",{staticClass:"key-tab-container"},[t(l,{ref:"infoForm",attrs:{id:"infoForm",inline:!0}},[t(a,[t("vsc-input",{ref:"keyNameInput",attrs:{title:"set to rename key",size:"mini"},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.rename.apply(null,arguments)}},model:{value:e.edit.name,callback:function(i){e.$set(e.edit,"name",i)},expression:"edit.name"}},[t("span",{staticClass:"key-detail-type",attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(e.key.type))]),t("i",{staticClass:"el-icon-check el-input__icon cursor-pointer",attrs:{slot:"suffix",title:"Click to rename"},on:{click:e.rename},slot:"suffix"})])],1),t(a,[t("vsc-input",{attrs:{type:"number",size:"mini"},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.ttlKey.apply(null,arguments)}},model:{value:e.edit.ttl,callback:function(i){e.$set(e.edit,"ttl",i)},expression:"edit.ttl"}},[t("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("TTL")]),t("i",{staticClass:"el-icon-check el-input__icon cursor-pointer",attrs:{slot:"suffix",title:"Click to change ttl"},on:{click:e.ttlKey},slot:"suffix"})])],1),t(a,[t("vsc-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"icon",icon:"el-icon-delete text-lg"},on:{click:e.deleteKey}}),t("vsc-button",{attrs:{type:"icon",icon:"el-icon-refresh text-lg"},on:{click:e.refresh}}),["string","ReJSON-RL"].includes(e.key.type)?[t(p,{staticStyle:{width:"95px"},attrs:{placeholder:"Default",size:"small"},on:{change:e.changeLanguage},model:{value:e.language.current,callback:function(i){e.$set(e.language,"current",i)},expression:"language.current"}},e._l(e.language.supports,function(i){return t(m,{key:i,attrs:{value:i}},[e._v(e._s(i))])}),1),e.key.type=="string"?t("div",{staticStyle:{"margin-left":"10px",display:"inline-block"}},[t("vsc-button",{attrs:{icon:"codicon-save",type:"primary",size:"small"},on:{click:function(i){return e.update()}}},[e._v(" Save ")])],1):e._e()]:e._e()],2)],1),t(l,{directives:[{name:"show",rawName:"v-show",value:["string","ReJSON-RL"].includes(e.key.type),expression:"['string','ReJSON-RL'].includes(key.type)"}],staticClass:"key-content-string"},[t(a,[t("div",{staticClass:"value-panel"},[t("codemirror",{ref:"cmEditor",staticClass:"json-panel",style:"height:"+e.remainHeight+"px",attrs:{options:e.cmOptions},model:{value:e.cmContent,callback:function(i){e.cmContent=i},expression:"cmContent"}})],1)])],1),e.key.type=="list"||e.key.type=="set"||e.key.type=="zset"||e.key.type=="hash"||e.key.type=="stream"?t("div",[t("div",[t("vsc-input",{staticClass:"filter-input mb-2",staticStyle:{width:"200px"},attrs:{size:"mini",placeholder:e.$t("result.searchNotice"),clearable:!0},model:{value:e.searchInput,callback:function(i){e.searchInput=i},expression:"searchInput"}}),t("vsc-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Add new key",placement:"bottom-start"}},[t("div",{staticClass:"ml-2 inline-block"},[e.key.type!="stream"?t("vsc-button",{staticStyle:{color:"var(--vscode-terminal-ansiYellow)"},attrs:{type:"icon",icon:"el-icon-circle-plus-outline text-lg"},on:{click:function(i){return e.showOpenDialog()}}}):e._e()],1)]),t(d,{staticStyle:{display:"inline-block"},attrs:{small:!0,total:e.dataCount,"page-size":e.pageSize,"current-page":e.pageIndex,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",background:""},on:{"current-change":i=>e.changePage(i,!0),"next-click":()=>e.changePage(1),"prev-click":()=>e.changePage(-1),"update:pageSize":function(i){e.pageSize=i},"update:page-size":function(i){e.pageSize=i},"update:currentPage":function(i){e.pageIndex=i},"update:current-page":function(i){e.pageIndex=i}}}),t(u,{attrs:{title:e.dialogTitle,visible:e.itemDialogVisiable,closeOnClickModal:!1,width:"30%","custom-class":"new-item-dialog"},on:{"update:visible":function(i){e.itemDialogVisiable=i}}},[t(l,{attrs:{"label-width":"60px"}},[e.key.type=="hash"?t(a,{attrs:{label:"key"}},[t("vsc-input",{attrs:{size:"mini"},model:{value:e.itemModel.key,callback:function(i){e.$set(e.itemModel,"key",i)},expression:"itemModel.key"}})],1):e._e(),e.key.type=="zset"?t(a,{attrs:{label:"score"}},[t("vsc-input",{attrs:{size:"mini"},model:{value:e.itemModel.score,callback:function(i){e.$set(e.itemModel,"score",i)},expression:"itemModel.score"}})],1):e._e(),t(a,{attrs:{label:"value"}},[t("vsc-input",{attrs:{size:"mini"},model:{value:e.itemModel.value,callback:function(i){e.$set(e.itemModel,"value",i)},expression:"itemModel.value"}})],1)],1),t("div",{staticClass:"dialog-footer text-center",attrs:{slot:"footer"},slot:"footer"},[t("vsc-button",{attrs:{type:"secondary"},on:{click:function(i){e.itemDialogVisiable=!1}}},[e._v(e._s(e.$t("common.cancel")))]),t("vsc-button",{attrs:{type:"primary"},on:{click:e.saveItem}},[e._v("Confirm")])],1)],1)],1),t("div",[t(c,{attrs:{data:e.filterData,height:e.remainHeight,border:"","header-cell-style":{padding:0}}},[t(o,{attrs:{type:"index",label:"Index",sortable:"",width:"60",align:"center"}}),e.key.type=="hash"?t(o,{attrs:{"sort-by":"key",resizable:"",sortable:"",label:"Key",align:"center",prop:"key"}}):e._e(),e.key.type=="zset"?t(o,{attrs:{"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"100",prop:"score"}}):e._e(),e.key.type=="stream"?t(o,{attrs:{"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"}}):e._e(),t(o,{attrs:{"sort-by":"value",resizable:"",sortable:"","show-overflow-tooltip":"",label:"Value",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[e.key.type=="hash"?t("span",{domProps:{textContent:e._s(i.row.value)}}):e.key.type=="zset"||e.key.type=="set"?t("span",{domProps:{textContent:e._s(i.row.value)}}):t("span",{domProps:{textContent:e._s(i.row)}})]}}],null,!1,256082163)}),t(o,{attrs:{label:"Operation",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[["hash","set","zset"].includes(e.key.type)?t("vsc-button",{attrs:{type:"icon",icon:"codicon codicon-edit text-base",title:"edit"},on:{click:function(r){return e.showEditDialog(i.row)}}}):e._e(),t("vsc-button",{staticClass:"ml-3",attrs:{type:"icon",icon:"codicon codicon-remove text-base",title:"delete"},on:{click:function(r){return e.deleteLine(i.row)}}})]}}],null,!1,4136666596)})],1)],1)]):e._e()],1)],2)},w=[],C=f(b,x,w,!1,null,"54d8d605",null,null);const H=C.exports;export{H as default};
